PREFIX mu: <http://mu.semte.ch/vocabularies/core/>
PREFIX dct: <http://purl.org/dc/terms/>
PREFIX adms: <http://www.w3.org/ns/adms#>
PREFIX toezicht: <http://mu.semte.ch/vocabularies/ext/supervision/>
PREFIX nmo: <http://www.semanticdesktop.org/ontologies/2007/03/22/nmo#>
PREFIX meb: <http://rdf.myexperiment.org/ontologies/base/>
PREFIX schema: <http://schema.org/>

INSERT {
    GRAPH <http://mu.semte.ch/graphs/organizations/141d9d6b-54af-4d17-b313-8d1c30bc3f5b> {
     ?review a schema:Review ;
            mu:uuid ?id ;
            schema:itemReviewed ?inzending ;
            adms:status ?newStatus .
    }
} WHERE {
  GRAPH <http://mu.semte.ch/graphs/organizations/141d9d6b-54af-4d17-b313-8d1c30bc3f5b> {
     ?melding a toezicht:InzendingVoorToezichtMelding ;
            mu:uuid ?meldingId ;
            dct:subject ?inzending ;
            adms:status ?oldStatus .
    BIND(SHA256(CONCAT("1b20ea36-106c-47da-8975-9a13ce5588ec", ":", ?meldingId)) AS ?id)
    BIND(IRI(CONCAT("http://data.lblod.info/review-submission/", ?id)) as ?review)
    BIND(IF(?oldstatus == <http://data.lblod.info/melding-statuses/te-behandelen>, 
            <http://lblod.data.gift/concepts/d72999bf-2ef4-4332-bd6e-49c8a9e2498e>,
            <http://lblod.data.gift/concepts/5b36ed48-491c-4177-ae31-31338dc46de1>) as newStatus)
  }
}
